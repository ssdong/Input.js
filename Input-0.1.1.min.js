(function(){var k={DESK_MENU:0,BACKSPACE:8,TAB:9,CLEAR:12,DN_LOCK:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,L_START:91,R_START:92,L_CMD:91,R_CMD:93,LAP_MENU:93,N_ZERO:96,N_1:97,N_2:98,
N_3:99,N_4:100,N_5:101,N_6:102,N_7:103,N_8:104,N_9:105,N_MULTI:106,N_PLUS:107,N_MINUS:109,N_PERIOD:110,N_DEVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F9:120,F10:121,LN_LOCK:144,SEMICOLON:186,EQUAL:187,COMMA:188,MINUS:189,PERIOD:190,SLASH:191,BACKTICK:192,L_BRACKET:219,BACKSLASH:220,R_BRACKT:221,S_QUOTE:222},p={add:function(a,b){void 0==a.start&&(a.start={});a.start[k[b[0]]]?a.start[k[b[0]]]++:a.start[k[b[0]]]=1;for(var c=b.length,d,e,f=0;f<c-1;f++)d=k[b[f]],e=k[b[f+1]],void 0==a[d]&&
(a[d]={}),a[d][e]?a[d][e]++:a[d][e]=1}},m={is_string:function(a){return"[object String]"===Object.prototype.toString.call(a)},is_boolean:function(a){return"[object Boolean]"===Object.prototype.toString.call(a)},is_function:function(a){return"[object Function]"===Object.prototype.toString.call(a)},is_undefined:function(a){return void 0===a},is_empty:function(a){if(null==a)return!0;if(0<a.length)return!1;if(0===a.length)return!0;for(var b in a)if(this.hasProp(a,b))return!1;return!0},same_array:function(a,
b){if(a.length!==b.length)return!1;for(var c=a.length,d=0;d<c;d++)if(a[d]!==b[d])return!1;return!0},hasProp:function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},string_to_array:function(a){a=a.toUpperCase().replace(/\s+/g," ").split(" ");for(var b=0;b<a.length;b++)""==a[b]&&a.splice(b,1);return a},string_to_object:function(a){var b={};a=this.string_to_array(a);for(var c=a.length,d=0;d<c;d++)b[a[d]]?++b[a[d]]:b[a[d]]=1;return b},attach_event:function(a,b,c){document.addEventListener?a.addEventListener(b,
c):document.attachEvent&&a.attachEvent("on"+b,c)},register_keys:function(a,b){for(var c=a.length,d=0;d<c;d++){if(void 0===k[a[d]])throw"Not support "+a[d];b.active_keys[k[a[d]]]?b.active_keys[k[a[d]]]++:b.active_keys[k[a[d]]]=1}},keys_to_keycode:function(a){var b="";a=string_to_array(a);for(var c=a.length,d=0;d<c;d++)b=d==c-1?b+a[d]:b+a[d]+" ";return b},make_package:function(a,b,c,d){var e={},f={};f.order=b;f.callback=c;f.time=d;e[a]=f;return e},store_sizetable:function(a,b){var c=b.size_table,d=
"";c[a]?(d=c[a][c[a].length-1],d=a.toString()+(parseInt(d.substr(1,d.length-1))+1),c[a].push(d)):(d=a.toString()+1,c[a]=[d]);return d},store_keypackage:function(a,b,c,d,e,f){var g={},h=b?this.string_to_array(a):this.string_to_object(a);g.key=h;g.key_origin=a;g.order=b;g.time=1E3*d;g.callback=c;g.keep_fire=!1;g.count=0;f.keys_package[e]=g},add_to_first:function(a,b,c){c=c.first_to_id;void 0==c[a]&&(c[a]=[]);c[a].push(b)},add_combo:function(a,b,c,d,e){if(!this.is_string(a))throw'function(ordered_combo) expects "keys" to be string';
if(!this.is_function(b))throw'function(ordered_combo) expects "callback" to be function';var f=this.string_to_array(a);if(!this.is_empty(f)){this.register_keys(f,e);var g=this.store_sizetable(f.length,e);this.store_keypackage(a,d,b,c,g,e);d&&(this.add_to_first(k[f[0]],g,e),p.add(e.machine,f))}},remove_firstoid:function(a,b,c){a=c.first_to_id[a];c=a.length;for(var d=0;d<c;d++)if(a[d]==b){a.splice(d,1);break}},remove_package:function(a,b){var c=b.keys_package;if(this.is_empty(c))return!1;for(var d=
b.size_table,e=d[a.length],f=e.length,g,h=0;h<f;h++)if(g=e[h],this.same_array(a,c[g].key))return d[a.length].splice(h,1),delete c[g],this.remove_firstoid(k[a[0]],g,b),!0;return!1},remove_activekeys:function(a,b){for(var c=b.active_keys,d=a.length,e=0;e<d;e++)1==c[k[a[e]]]?delete c[k[a[e]]]:c[k[a[e]]]--},remove_machine:function(a,b){var c=b.machine,d=a.length,e,f;e=k[a[0]];1==c.start[e]?delete c.start[e]:c.start[e]--;for(var g=0;g<d-1;g++)e=k[a[g]],f=k[a[g+1]],1==c[e][f]?delete c[e][f]:c[e][f]--},
destroy_combo:function(a,b){var c=this.string_to_array(a);this.remove_package(c,b)&&(this.remove_activekeys(c,b),this.remove_machine(c,b))},destroy_all:function(a){a.active_keys={};a.keys_package={};a.size_table={};a.first_to_id={};a.machine={};a.keydown_buffer=[];a.keyup_buffer=[]},makeup_keyup_obj:function(a,b,c){c={};c.current=a;c.id=b;c.pass=1;c.v=!0;return c},timer:function(a,b,c,d){setTimeout(function(a){return function(){var f=d.keyup_buffer;if(!a.is_empty(f))for(var g=0;g<=c&&!a.is_empty(f);g++)if(b==
f[g].id){f[g].v=!1;break}}}(this),a)},fire:function(a,b){for(var c=b.keys_package,d=a.length,e,f=0;f<d;f++)e=c[a[f]].callback,c[a[f]].count++,e()},fire_keydown:function(a,b){},fire_keyup:function(a,b){if(this.hasProp(b.active_keys,a)){for(var c=b.keyup_buffer,d=b.keys_package,e=b.first_to_id,f=b.machine,g=[],h,m,l=0;l<c.length;l++)h=c[l],m=d[h.id],h.v?this.hasProp(f[h.current],a)&&k[m.key[h.pass]]==a?h.pass+1==m.key.length?(g.push(h.id),c.splice(l,1),l--):(h.current=a,h.pass++):(c.splice(l,1),l--):
(c.splice(l,1),l--);if(this.hasProp(f.start,a))for(e=e[a],f=e.length,l=0;l<f;l++)1==d[e[l]].key.length?g.push(e[l]):(h=d[e[l]].time,c.push(this.makeup_keyup_obj(a,e[l],b)),h&&this.timer(h,e[l],l,b));0<g.length&&this.fire(g,b)}else b.keyup_buffer=[]},count:function(a,b){var c=0,d=b.keys_package,e=b.size_table,f=this.string_to_array(a),e=e[f.length];if(this.is_empty(d)||void 0==e)return c;for(var g=e.length,h,k=0;k<g;k++)if(h=e[k],this.same_array(f,d[h].key)){c=d[h].count;break}return c}},n={};n.Listener=
function(){function a(a){this.active_keys={};this.keys_package={};this.size_table={};this.first_to_id={};this.machine={};this.keydown_buffer=[];this.keyup_buffer=[];a=a||document.body;m.attach_event(a,"keyup",function(a){return function(b){return a.user_input(b,!1)}}(this))}a.extend=function(b){for(var c in b)a.prototype[c]=b[c]};a.extend({unordered_combo:function(a,c,d){m.add_combo(a,c,d,!1,this)},ordered_combo:function(a,c,d){m.add_combo(a,c,d,!0,this)},delete_combo:function(a){m.destroy_combo(a,
this)},delete_all:function(){m.destroy_all(this)},user_input:function(a,c){var d=a.keyCode;c?m.fire_keydown(d,this):m.fire_keyup(d,this)},count_times:function(a){return m.count(a,this)},get_keypackage:function(){return this.keys_package},get_sizetable:function(){return this.size_table},get_activekeys:function(){return this.active_keys},get_id:function(){return this.first_to_id},get_machine:function(){return this.machine},get_buffer:function(){return this.keyup_buffer}});return a}();"undefined"!==
typeof module&&"undefined"!==typeof module.exports?module.exports=n:"function"===typeof define&&define.amd?define([],function(){return n}):window.Input=n})();